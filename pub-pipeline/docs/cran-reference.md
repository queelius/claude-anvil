# CRAN Submission Reference

## Sources
- [CRAN Repository Policy](https://cran.r-project.org/web/packages/policies.html)
- [Writing R Extensions](https://cran.r-project.org/doc/manuals/R-exts.html)
- [r-pkgs.org Release Chapter](https://r-pkgs.org/release.html)
- [CRAN Incoming Dashboard](https://r-hub.github.io/cransays/articles/dashboard.html)

---

## Pre-Submission Checklist

### DESCRIPTION File

#### Required Fields
- [ ] **Package**: Name matches directory name, uses only ASCII letters, numbers, and dots; starts with a letter; at least two characters
- [ ] **Title**: Title Case, no terminal period, no redundant "A Package for..." or "R Package for...", no package name in title
- [ ] **Version**: Follows `major.minor.patch` or `major.minor-patch` convention; incremented from any previous CRAN version
- [ ] **Authors@R**: Uses `person()` with proper roles:
  - `aut` — author (wrote substantial code)
  - `cre` — creator/maintainer (exactly one, with valid email)
  - `ctb` — contributor
  - `cph` — copyright holder (required if bundling third-party code)
  - `fnd` — funder (optional)
- [ ] **Maintainer email**: Real, monitored address belonging to a person (not a mailing list or generic address)
- [ ] **Description**: One paragraph, complete sentences. No package name. Use author-year citations with DOI, ISBN, or URL in angle brackets: `<doi:10.1234/example>` or `<https://example.com>`
- [ ] **License**: From CRAN's accepted list (MIT, GPL-2, GPL-3, Apache-2.0, BSD_2_clause, BSD_3_clause, LGPL, Artistic-2.0, CC BY 4.0 for data packages). Use `+ file LICENSE` for MIT and BSD variants
- [ ] **URL**: Package homepage, GitHub repo, or pkgdown site (comma-separated if multiple)
- [ ] **BugReports**: Link to issue tracker (e.g., `https://github.com/user/pkg/issues`)

#### Optional but Recommended Fields
- [ ] **Encoding**: `UTF-8`
- [ ] **Language**: `en-US` (for spell checking)
- [ ] **Roxygen**: `list(markdown = TRUE)` if using roxygen2 markdown
- [ ] **RoxygenNote**: Current roxygen2 version
- [ ] **Config/testthat/edition**: `3` (if using testthat)
- [ ] **VignetteBuilder**: `knitr` (if building vignettes with knitr/rmarkdown)

#### LICENSE File
- [ ] **MIT/BSD**: Requires a `LICENSE` file with `YEAR:` and `COPYRIGHT HOLDER:` fields
- [ ] **GPL-2/GPL-3**: No separate file needed (full text ships with R)
- [ ] **Bundled code**: Third-party code must have compatible license and `Authors@R` copyright holders

### NAMESPACE

- [ ] Auto-generated by roxygen2 (never edit by hand)
- [ ] All public functions explicitly exported via `@export`
- [ ] Internal helper functions not exported (no `@export` tag)
- [ ] Imports from other packages use `@importFrom pkg fun` or `pkg::fun()` in code
- [ ] No `exportPattern("^[^\\.]")` catching everything (too broad)
- [ ] S3 methods registered via `@export` on the method (roxygen2 handles `S3method()` registration)

### Code Quality

#### Prohibited Patterns
- [ ] No `q()` or `quit()` calls anywhere in package code
- [ ] No `library()` or `require()` in package code (use `Imports` and `::` instead)
- [ ] No `.Internal()` calls (internal C API, forbidden for packages)
- [ ] No `:::` to access unexported functions from other packages
- [ ] No `assign()` to `.GlobalEnv` or `baseenv()`
- [ ] No `<<-` assignments to global variables (except within R6 or reference classes)
- [ ] No `Sys.setenv()` without restoring via `on.exit()`
- [ ] No `setwd()` without restoring via `on.exit(oldwd)` or `withr::with_dir()`
- [ ] No `options()` modifications without `on.exit(options(old))` or `withr::with_options()`
- [ ] No `par()` modifications without `on.exit(par(oldpar))` or `withr::with_par()`
- [ ] No `sink()` calls without restoring
- [ ] No `Sys.setlocale()` without restoring
- [ ] No compiled code calling `assert`, `abort`, or `exit` (use `Rf_error()` instead)
- [ ] No Fortran `STOP` statements (use `rexit()` instead)

#### File System Discipline
- [ ] No writing to user's home directory, working directory, or package installation directory
- [ ] Temporary files written only to `tempdir()` — cleaned up via `on.exit(unlink(tmpfile))`
- [ ] Persistent user data stored only via `tools::R_user_dir(package, which = "data")` or `tools::R_user_dir(package, which = "config")`
- [ ] Cache files stored via `tools::R_user_dir(package, which = "cache")`
- [ ] All file paths constructed with `file.path()` (not `paste()` with `/`)

#### External Resources
- [ ] All HTTP connections use HTTPS
- [ ] SSL/TLS certificates verified (no `ssl.verifypeer = FALSE`)
- [ ] Graceful failure when internet unavailable (wrap in `tryCatch()`, never error in examples/tests)
- [ ] No starting external software (PDF viewers, browsers) in examples, tests, or vignettes
- [ ] Multi-threaded code (OpenMP, parallel) uses at most 2 cores by default; respects `options("mc.cores")` and environment variables `OMP_NUM_THREADS`, `R_DEFAULT_NUM_THREADS`

### Documentation

#### Function Documentation (Rd / roxygen2)
- [ ] Every exported function has an `@returns` tag describing the return value (type + meaning)
- [ ] Every exported function has `@examples` with runnable code
- [ ] Use `\donttest{}` for examples that are slow (>5s) or require internet — these run on CRAN but not during `R CMD check`
- [ ] Do NOT use `\dontrun{}` unless the example truly cannot run (requires credentials, hardware, etc.) — CRAN reviewers flag this
- [ ] `@param` tags for every argument, with type and description
- [ ] Internal functions documented with `@keywords internal` or `@noRd`
- [ ] Cross-references use `\code{\link{fun}}` or `[fun()]` in roxygen2 markdown mode

#### Vignettes
- [ ] At least one vignette demonstrating primary use case
- [ ] Vignettes build cleanly with `devtools::build_vignettes()`
- [ ] No hardcoded file paths
- [ ] External data/API calls wrapped in conditional checks or pre-computed
- [ ] Vignette title set in YAML frontmatter and matches `\VignetteIndexEntry{}`

#### Other Documentation
- [ ] `NEWS.md` documents user-visible changes for this version
- [ ] `README.md` with installation instructions, basic usage, badges
- [ ] `cran-comments.md` prepared with test environments, R CMD check results, and downstream dependencies
- [ ] All URLs valid — run `urlchecker::url_check()` to verify
- [ ] No broken internal links in documentation

### Dependencies

- [ ] `Depends`: Only for packages that must be attached (rare; typically just R version: `R (>= 4.0)`)
- [ ] `Imports`: Packages used in code (functions called via `::` or `@importFrom`)
- [ ] `Suggests`: Packages used only in examples, tests, or vignettes
- [ ] `LinkingTo`: C/C++ header-only packages (Rcpp, BH, cpp11)
- [ ] All strong dependencies (Depends, Imports, LinkingTo) available on CRAN or Bioconductor
- [ ] Suggested packages used conditionally: `if (requireNamespace("pkg", quietly = TRUE))`
- [ ] No orphaned CRAN packages as hard dependencies
- [ ] No GitHub-only packages in Imports
- [ ] Version requirements specified only when necessary: `pkg (>= 1.0.0)`
- [ ] Dependency count reasonable (avoid importing dozens of packages for trivial use)

### Size Constraints

- [ ] Source tarball under 10MB (hard limit; files can be excluded via `.Rbuildignore`)
- [ ] Installed package size reasonable (data packages may be larger, but justify in `cran-comments.md`)
- [ ] Data files in efficient formats: `.rda` with `xz` compression, or `.csv` in `inst/extdata/`
- [ ] Large datasets: consider a companion data package or download-on-demand via `piggyback` or `pins`
- [ ] Each example runs in a few seconds; `\donttest{}` for anything over ~5 seconds
- [ ] Total `R CMD check` time under 10 minutes

### Testing

- [ ] `R CMD check --as-cran` passes with 0 errors, 0 warnings, 0 notes
- [ ] If notes remain, each is explained in `cran-comments.md`
- [ ] Tested on current R release and R-devel
- [ ] Test suite exists (testthat, tinytest, or RUnit) with reasonable coverage
- [ ] Tests do not write to user directories
- [ ] Tests that require internet skip gracefully when offline: `skip_if_offline()`
- [ ] Tests that require suggested packages skip gracefully: `skip_if_not_installed("pkg")`
- [ ] No tests that depend on CRAN infrastructure or specific CRAN mirror availability

---

## Submission Workflow

### Step-by-Step Process

1. **Version bump**: `usethis::use_version("minor")` (or `"patch"`, `"major"`)

2. **Update documentation**: `devtools::document()` to regenerate `NAMESPACE` and `.Rd` files

3. **Run local checks**:
   ```r
   devtools::check(args = "--as-cran")
   ```
   Must pass with 0 errors, 0 warnings, and ideally 0 notes.

4. **Windows cross-check** (if not on Windows):
   ```r
   devtools::check_win_devel()
   ```
   Results emailed within 30-60 minutes. Check for platform-specific failures.

5. **Multi-platform check** via R-hub:
   ```r
   rhub::check_for_cran()
   ```
   Tests on Linux, Windows, and macOS with different R versions.

6. **macOS ARM64 check** (if applicable):
   ```r
   devtools::check_mac_release()
   ```

7. **Reverse dependency check** (updates only):
   ```r
   revdepcheck::revdep_check(num_workers = 4)
   ```
   Document results in `cran-comments.md`. Contact affected maintainers if breakage found.

8. **Prepare `cran-comments.md`**:
   ```r
   usethis::use_cran_comments()
   ```
   Include: test environments, R CMD check results, reverse dependency results, and explanations for any notes.

9. **Validate URLs**:
   ```r
   urlchecker::url_check()
   ```

10. **Submit**:
    ```r
    devtools::submit_cran()
    ```
    Or use the web form at https://CRAN.R-project.org/submit.html

11. **Confirm submission**: Click the confirmation link in the email sent to the maintainer address. Submission is not registered until confirmed.

12. **Track progress**: Monitor https://r-hub.github.io/cransays/articles/dashboard.html or https://CRAN.R-project.org/incoming/ for your package's status through the queue folders:
    - `inspect` — automated checks running
    - `pretest` — building and testing
    - `human` — awaiting manual review
    - `publish` — accepted, will appear on CRAN shortly

### Post-Acceptance

1. **Create GitHub release**: `usethis::use_github_release()` — tags the commit and creates a release
2. **Bump to dev version**: `usethis::use_dev_version(push = TRUE)` — sets version to `x.y.z.9000`
3. **Monitor CRAN check results**: Watch https://cran.r-project.org/web/checks/check_results_{package}.html for a few days
4. **Update pkgdown site**: Rebuild and deploy if applicable
5. **Announce**: Blog post, social media, R-bloggers, rOpenSci newsletter (if applicable)

---

## Update-Specific Requirements

- [ ] Version number must be higher than current CRAN version
- [ ] Run reverse dependency checks: `revdepcheck::revdep_check(num_workers = 4)`
- [ ] No more than every 1-2 months for established packages (more frequent only with CRAN team approval)
- [ ] Breaking changes: email affected reverse-dependency maintainers at least 2 weeks before submission
- [ ] Document all changes in `NEWS.md`
- [ ] `cran-comments.md` must mention reverse dependency check results
- [ ] If CRAN emailed about issues (check failures, policy violations): fix within 2 weeks or package may be archived

---

## Common Rejection Reasons

### Documentation Issues
1. **Missing `@returns` tags**: Every exported function must document its return value. Even functions called for side effects should have `@returns` with "Invisibly returns NULL" or similar
2. **`\dontrun{}` instead of `\donttest{}`**: CRAN reviewers reject `\dontrun{}` unless the example genuinely cannot be run (needs API key, paid service, specific hardware). Use `\donttest{}` for slow examples
3. **Title formatting**: Title must be in Title Case, must not end with a period, must not begin with "A Package for" or the package name
4. **Missing or incomplete documentation**: Every `@param` must be documented; every exported function needs examples

### File System and Global State
5. **Writing outside `tempdir()`**: Any file creation must go to `tempdir()` or `tools::R_user_dir()`. Never write to the working directory, home directory, or package directory
6. **Modifying global state without restoration**: `options()`, `par()`, `setwd()`, `Sys.setenv()`, `sink()` must all be restored via `on.exit()` or `withr` wrappers. This is the single most common first-submission rejection
7. **Starting external processes**: Examples and tests must not open browsers, PDF viewers, or other GUI applications

### Code and Dependencies
8. **Non-portable code**: Package must work on at least Linux, Windows, and macOS. Avoid platform-specific system calls without proper guards
9. **Dependencies on non-CRAN packages**: All packages in `Imports`, `Depends`, and `LinkingTo` must be on CRAN or Bioconductor. GitHub-only packages are not allowed
10. **Missing conditional checks for Suggested packages**: Code using Suggested packages must guard with `if (requireNamespace("pkg", quietly = TRUE))`
11. **Excessive example/test runtime**: Individual examples should take a few seconds at most. Total check time should be under 10 minutes
12. **Using `:::` to access unexported functions**: Access only exported APIs from other packages

### Policy and Process
13. **Non-standard or missing LICENSE file**: MIT and BSD licenses require a `LICENSE` file with year and copyright holder
14. **Invalid or broken URLs**: All URLs in documentation must resolve. Use `urlchecker::url_check()` to verify
15. **Missing copyright attribution**: Bundled third-party code (C libraries, JavaScript, etc.) must have copyright holders listed in `Authors@R` with role `cph`
16. **Internet-dependent tests without skip logic**: Tests that require internet must use `skip_if_offline()` or equivalent

---

## Resubmission Protocol

### After Rejection
1. **Fix ALL issues**: Address every point raised by the reviewer. Partial fixes lead to repeated rejection and frustrate volunteer reviewers
2. **Update `cran-comments.md`**: Describe what changed since the last submission. Reference specific reviewer feedback
3. **Re-run all checks**: `devtools::check(args = "--as-cran")` must pass cleanly after fixes
4. **Resubmit**: Use `devtools::submit_cran()` or the web form. The confirmation email subject should indicate this is a resubmission

### Timing and Etiquette
- [ ] Do not resubmit more than once per week unless asked to by CRAN
- [ ] CRAN reviewers are volunteers — be respectful and concise in all communications
- [ ] Reply to reviewer emails promptly and address all points
- [ ] If you disagree with a requirement, explain your reasoning politely — but the reviewer's decision is final
- [ ] Repeated problematic submissions may result in the maintainer being flagged

### Package Archived by CRAN
- [ ] Packages failing checks are given warnings, then archived if not fixed within the deadline (typically 2 weeks)
- [ ] To restore an archived package: fix all issues, email `CRAN-submissions@R-project.org` with explanation
- [ ] Archived packages remain in the CRAN archive and can be reinstalled from source, but are removed from the main repository

---

## Quick Reference: Key Commands

| Task | Command |
|------|---------|
| Check locally | `devtools::check(args = "--as-cran")` |
| Check on Windows | `devtools::check_win_devel()` |
| Check on multiple platforms | `rhub::check_for_cran()` |
| Validate URLs | `urlchecker::url_check()` |
| Reverse dependency check | `revdepcheck::revdep_check(num_workers = 4)` |
| Prepare cran-comments | `usethis::use_cran_comments()` |
| Submit to CRAN | `devtools::submit_cran()` |
| Create GitHub release | `usethis::use_github_release()` |
| Bump to dev version | `usethis::use_dev_version(push = TRUE)` |

---

**Last Updated**: 2026-02-16
